# Домашнее задание к занятию "10.06. Инцидент-менеджмент"


|Вопросы | Комментарии
|--------| ------------|
Краткое описание инцидента | В 10:52  вечера в воскресенье по UTC несколько служб на GitHub.com были затронуты сетевым переключением и последующим сбоем базы данных, что привело к противоречивой информации, представленной на веб-сайте.
Предшествующие события | Плановые работы по техническому обслуживанию для замены вышедшего из строя оптического оборудования 100G.
Причина инцидента | Из-за временной сетевой недоступности Orchestrator провел кворум и собрал кластер на западном побережье США. Серверы баз данных в центре обработки данных на Восточном побережье США содержали короткий период записей, которые не были реплицированы на объект на Западном побережье США. Поскольку кластеры баз данных в обоих центрах обработки данных теперь содержали записи, которых не было в другом центре обработки данных, инженеры не смогли безопасно перенести основной сервер обратно в центр обработки данных на Восточном побережье США.
Воздействие | Возник риск потери пользовтаельских данных. Во время восстановления на Западном побережье наблюдались проблемы с доступностью сервиса. Была приостановлена доставка webhook и сборки GitHub Pages. 
Обнаружение | 21 октября 2018 22:54 UTC Системы мониторинга начали генерировать предупреждения, указывающие на то, что в системах возникли многочисленные сбои.
Реакция | В 23:02 UTC инженеры из команды первого реагирования определили, что топологии для многочисленных кластеров баз данных находятся в неожиданном состоянии. 
Восстановление | Команда реагирования вручную заблокировала внутренний инструмент развертывания, чтобы предотвратить внесение каких-либо дополнительных изменений. Было прекращено выполнение заданий, которые записывают метаданные о таких вещах, как push. Инжененры баз данных запустили создание резервной копии БД с последующим ее восстаностановлением на сбойных нодах для восстановления синхронизации реплики в обоих сайтах.
[Таймлайн](https://www.githubstatus.com/history?page=16) | 2018-10-21 23:09:19 - Мы расследуем сообщения о повышенном количестве ошибок. 2018-10-21 23:13:31 - Мы расследуем сообщения о недоступности сервиса. 2018-10-21 23:43:55 - Мы расследуем проблемы с доступом GitHub.com . 2018-10-22 00:05:37 - У нас сбой в системе хранения данных, чтобы восстановить доступ к GitHub.com. 2018-10-22 00:23:54 - Мы продолжаем работать над переносом системы хранения данных, чтобы восстановить доступ к GitHub.com . 2018-10-22 01:02:49 - Мы продолжаем перенос системы хранения данных, чтобы восстановить полный доступ к GitHub.com . 2018-10-22 01:22:22 - Мы продолжаем работать над переносом системы хранения данных, чтобы восстановить доступ к GitHub.com . 2018-10-22 02:01:43 - Мы продолжаем работу по ремонту системы хранения данных для GitHub.com . Во время этого процесса вы можете увидеть противоречивые результаты. 2018-10-22 02:23:48 - Мы продолжаем ремонт системы хранения данных для GitHub.com . Во время этого процесса вы можете увидеть противоречивые результаты. 2018-10-22 06:51:50 - В настоящее время мы находимся на более поздних стадиях операции восстановления с целью предоставления полностью согласованных данных в течение следующих 2 часов. 2018-10-22 07:35:38 - Наши операции восстановления проходят, как и ожидалось, на пути к предоставлению полностью согласованных данных в течение следующих 1,5 часов. 2018-10-22 08:19:00 - Наши операции восстановления все еще выполняются, чтобы обеспечить согласованность данных в течение часа. Мы опубликовали обновление на https://blog.github.com/2018-10-21-october21-incident-report /. 2018-10-22 09:47:03 - Мы продолжаем отслеживать восстановление, которое занимает больше времени, чем ожидалось. По нашим оценкам, они будут пойманы через полтора часа. 2018-10-22 11:56:52 - Большинство процессов восстановления завершено. Мы ожидаем, что все хранилища данных будут полностью согласованы в течение следующего часа. 2018-10-22 13:18:59 - Мы проверяем согласованность информации во всех хранилищах данных. Сборки веб-страниц и страниц остаются приостановленными. 2018-10-22 15:09:47 - Фоновые задания остаются приостановленными, поскольку мы приближаемся к завершению проверки согласованности данных. 2018-10-22 16:24:01 - Мы завершили проверку согласованности данных и включили некоторые фоновые задания. Мы продолжаем следить за восстановлением системы и ожидаем возобновления предоставления веб-ссылок в 16:45 UTC. 2018-10-22 16:45:19 - Мы возобновили доставку веб-ссылок и продолжим мониторинг по мере обработки отложенного бэклога событий. 2018-10-22 16:51:27 - Мы возобновили сборку страниц и продолжим отслеживать по мере обработки отложенного списка событий. 2018-10-22 17:32:55 - Мы временно приостановили доставку веб-ссылок, пока решаем проблему. Мы работаем над возобновлением доставки как можно скорее. 2018-10-22 18:09:34 - Доставка Webhook остается приостановленной, пока мы решаем проблему. В настоящее время мы внедряем исправление и ожидаем возобновления доставки в ближайшее время. 2018-10-22 18:26:41 - Мы возобновили доставку webhook и продолжим мониторинг по мере обработки накопившихся событий. 2018-10-22 18:40:20 - Мы работаем над задержками доставки веб-хуков и сборки страниц. Мы продолжаем следить за восстановлением сайта. 2018-10-22 19:32:50 - Мы продолжаем работать над задержками сборки страниц и доставки веб-ссылок и отслеживаем, как сайт восстанавливается. 2018-10-22 20:03:52 - Мы продолжаем работать над задержками сборки страниц и доставки веб-ссылок, и мы отслеживаем, как сайт восстанавливается. 2018-10-22 20:37:25 - Мы продолжаем работать над задержками сборки страниц и доставки веб-хуков. Мы следим за восстановлением сайта. 2018-10-22 21:11:49 - Мы продолжаем работать над задержками сборки страниц и доставки веб-хуков. Мы следим за восстановлением сайта. 2018-10-22 21:46:24 - Мы продолжаем работать над задержками сборки страниц и доставки веб-ссылок и отслеживаем, как сайт восстанавливается. 2018-10-22 22:23:07 - Поставки Webhook увеличились, и мы продолжаем работать с задержками сборки страниц по мере восстановления сайта. 2018-10-22 23:03:57 - Все работает нормально.
Последующие действия | Организационные инициативы. Этот инцидент привел к изменению нашего мышления в отношении надежности сайта. Мы узнали, что ужесточение оперативного контроля или увеличение времени реагирования являются недостаточными гарантиями надежности сайта в такой сложной системе сервисов, как наша. Чтобы поддержать эти усилия, мы также начнем систематическую практику проверки сценариев сбоев до того, как они смогут повлиять на вас. Эта работа будет включать в себя будущие инвестиции в разработку инструментов для устранения неисправностей и разработки хаоса на GitHub. Технические инициативы: 1. Настройте конфигурацию Orchestrator, чтобы предотвратить распространение праймериз базы данных через региональные границы. Действия Orchestrator вели себя так, как было настроено, несмотря на то, что наш уровень приложений не смог поддержать это изменение топологии. Выборы лидера в регионе, как правило, безопасны, но внезапное введение межстрановой задержки стало основным фактором, способствующим этому инциденту. 2.Ускорить переход на новый механизм отчетности о состоянии. 
