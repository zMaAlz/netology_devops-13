Домашнее задание к занятию "3.4. Операционные системы, лекция 2"
----------------------------------------------------------------

1- *На лекции мы познакомились с node_exporter. В демонстрации его исполняемый файл запускался в background. Этого достаточно для демо, но не для настоящей production-системы, где процессы должны находиться под внешним управлением. Используя знания из лекции по systemd, создайте самостоятельно простой unit-файл для node_exporter*

Создаем файл в /etc/systemd/system/node_exporter.service Содержание:
![image](https://user-images.githubusercontent.com/87389868/140639975-8cf518e5-314f-4c88-b3f4-4797f6f01c54.png)

EnvironmentFile:
![image](https://user-images.githubusercontent.com/87389868/140640083-891c808f-8e23-4624-aa71-9a8fa01c0aca.png)


добавляем в автозапуск systemctl enable node_exporter.service

![image](https://user-images.githubusercontent.com/87389868/140640251-43611abe-d4eb-4234-9eb4-13a463e0c1b3.png)



2- *Ознакомьтесь с опциями node_exporter и выводом /metrics по-умолчанию. Приведите несколько опций, которые вы бы выбрали для базового мониторинга хоста по CPU, памяти, диску и сети.*

* cpu -	Exposes CPU statistics
* loadavg -	Exposes load average.
* diskstats -	Exposes disk I/O statistics.
* filesystem -	Exposes filesystem statistics, such as disk space used.
* meminfo	- Exposes memory statistics.
* netstat	- Exposes network statistics from /proc/net/netstat. This is the same information as netstat -s.


3- *Установите в свою виртуальную машину Netdata. Воспользуйтесь готовыми пакетами для установки (sudo apt install -y netdata).*

![image](https://user-images.githubusercontent.com/87389868/140527184-591941e7-d4f7-4dc0-919a-edca1ead7e7e.png)

4- *Можно ли по выводу dmesg понять, осознает ли ОС, что загружена не на настоящем оборудовании, а на системе виртуализации?*

Да, можно. dmesg | grep "Hypervisor detected" В виртуальной среде результат будет - [0.000000] Hypervisor detected: KVM


5- *Как настроен sysctl fs.nr_open на системе по-умолчанию? Узнайте, что означает этот параметр. Какой другой существующий лимит не позволит достичь такого числа (ulimit --help)?*

fs.nr_open = 1048576
Параметр fs.nr_open отвечает за лимит открытия файлов (максимальный лимит). До предела не позволит дойти лимит установленный в модуле pam_limits.so(лимиты для пользователей и групп). open files (-n) 1024 
 

6- *Запустите любой долгоживущий процесс (не ls, который отработает мгновенно, а, например, sleep 1h) в отдельном неймспейсе процессов; покажите, что ваш процесс работает под PID 1 через nsenter. Для простоты работайте в данном задании под root (sudo -i). Под обычным пользователем требуются дополнительные опции (--map-root-user) и т.д.*

![image](https://user-images.githubusercontent.com/87389868/140576613-00229aba-7c11-4d0f-afb4-aa967f565eb1.png)


7- *Найдите информацию о том, что такое :(){ :|:& };:. Запустите эту команду в своей виртуальной машине Vagrant с Ubuntu 20.04 (это важно, поведение в других ОС не проверялось). Некоторое время все будет "плохо", после чего (минуты) – ОС должна стабилизироваться. Вызов dmesg расскажет, какой механизм помог автоматической стабилизации. Как настроен этот механизм по-умолчанию, и как изменить число процессов, которое можно создать в сессии?*

 :(){ :|:& };: - Логическая бомба (известная также как fork bomb).

cgroups – механизм ядра, позволяющий ограничивать использование, вести учет и изолировать потребление системных ресурсов (ЦП, память, дисковый ввод/вывод, сеть и т. п.) на уровне коллекций процессов. Значение по умолчанию задается в файле /lib/systemd/system/user-.slice.d/10-defaults.conf
 
 ![image](https://user-images.githubusercontent.com/87389868/140604342-41535e2e-d148-4195-80e8-fb4964d7e027.png)

Изменить ограничение можно увеличив значение TasksMax в блоке [Slice]. 
